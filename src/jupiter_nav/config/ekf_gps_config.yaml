# Global EKF Configuration (Map Frame)
# Fuses Odom + IMU + GPS
# Used for: Generating map -> odom transform

ekf_filter_node_map:
  ros__parameters:
    frequency: 30.0
    sensor_timeout: 0.1
    two_d_mode: true
    publish_tf: true
    
    # Frames
    map_frame: map
    odom_frame: odom
    base_link_frame: base_footprint
    world_frame: map
    
    # -------------------------------------
    # 1. Odometry (Same as Local EKF)
    # -------------------------------------
    odom0: /kiss/odometry
    odom0_config: [true,  true,  false,    # x, y, z
                   false, false, true,     # r, p, yaw
                   false, false, false,    # vx, vy, vz
                   false, false, false,    # vroll, vpitch, vyaw
                   false, false, false]    # ax, ay, az
    odom0_differential: false
    odom0_relative: false
    odom0_queue_size: 10

    # -------------------------------------
    # 2. IMU (Same as Local EKF)
    # -------------------------------------
    imu0: /imu/data_calibrated
    imu0_config: [false, false, false,
                  false, false, false,
                  false, false, false,
                  false, false, true,      # vyaw
                  false, false, false]
    imu0_differential: false
    imu0_relative: false
    imu0_queue_size: 10
    imu0_remove_gravitational_acceleration: true
    
    # -------------------------------------
    # 3. GPS (From NavSat Transform)
    # -------------------------------------
    odom1: /odometry/gps
    odom1_config: [true,  true,  false,    # x, y, z
                   false, false, false,    # r, p, yaw
                   false, false, false,    # vx, vy, vz
                   false, false, false,    # vroll, vpitch, vyaw
                   false, false, false]    # ax, ay, az
    odom1_differential: false
    odom1_relative: false
    odom1_queue_size: 10

    # Process Noise and Covariance (Optimized for Outdoor)
    process_noise_covariance: [0.05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.05, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.06, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.03, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.03, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.06, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.025, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.025, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.04, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.02, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.015]

# NavSat Transform Node (GPS -> Odom)
navsat_transform_node:
  ros__parameters:
    frequency: 30.0
    delay: 3.0
    magnetic_declination_radians: 0.0 # 한국 대략 -0.15 (지역에 맞게 수정 필요)
    yaw_offset: 0.0                  # IMU yaw가 East=0, North=PI/2가 되도록 보정 (ENU standard)
    zero_altitude: true
    broadcast_utm_transform: true
    publish_filtered_gps: true
    use_odometry_yaw: false
    wait_for_datum: false
