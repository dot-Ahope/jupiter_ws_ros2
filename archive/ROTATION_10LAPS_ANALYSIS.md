# 90ë„ íšŒì „ í…ŒìŠ¤íŠ¸ - 10ë°”í€´ íšŒì „ ë¬¸ì œ ë¶„ì„

## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ (rotation_test_20251016_135007.csv)

### ì‹¤ì œ ë™ì‘
- **ë¬¼ë¦¬ì  íšŒì „**: ì•½ 10ë°”í€´ (3600Â°)
- **í…ŒìŠ¤íŠ¸ ì‹œê°„**: 12ì´ˆ
- **ëª…ë ¹**: 90Â° ì¢ŒíšŒì „ (0.3 rad/s)

### ì„¼ì„œ ë°ì´í„° ë¶„ì„

#### 1. íœ  ì˜¤ë„ë©”íŠ¸ë¦¬ (/odom_raw) - ì •ìƒ ë™ì‘ âœ…
```csv
ì‹œê°„(s)  yaw(rad)   yaw(deg)  angular_z(rad/s)
1.085    0.089932    5.15      0.830
2.116    1.397266   80.06      1.350
3.359    3.032905  173.77      1.350
5.213   -0.695153  -39.83      1.350
7.067    1.725854   98.88      1.340
11.564   1.506375   86.31      1.370  â† ê±°ì˜ 90ë„ ë„ë‹¬
11.770   1.519401   87.06      0.000  â† ì •ì§€
```

**íŠ¹ì§•**:
- âœ… 11.5ì´ˆì— **86.31Â°** ë„ë‹¬ (ëª©í‘œ: 90Â°)
- âœ… 11.77ì´ˆì— ì •ì§€ (angular_z = 0)
- âš ï¸ ê°ì†ë„ê°€ **1.35 rad/s** (ëª…ë ¹: 0.3 rad/s) â†’ **4.5ë°° ë¹ ë¦„**

#### 2. ìœµí•© ì˜¤ë„ë©”íŠ¸ë¦¬ (/odometry/filtered) - ì‹¬ê°í•œ ë¬¸ì œ âŒ
```csv
ì‹œê°„(s)  yaw(rad)   yaw(deg)  angular_z(rad/s)
0.105    0.002231    0.13      0.000220
1.137    0.002383    0.14      0.000422
5.264    0.004157    0.24      0.000422
7.740    0.005170    0.30      0.000422
```

**ë¬¸ì œ**:
- âŒ 12ì´ˆ ë™ì•ˆ **0.17Â°**ë§Œ ì¸ì‹ (ì‹¤ì œ: 87Â°)
- âŒ ê°ì†ë„ **0.0004 rad/s** (ëª…ë ¹: 0.3 rad/s) â†’ **750ë°° ëŠë¦¼**
- âŒ EKFê°€ íœ  ì˜¤ë„ë©”íŠ¸ë¦¬ì˜ yawë¥¼ ê±°ì˜ ë¬´ì‹œ

#### 3. IMU (/imu/data_filtered)
```csv
ì‹œê°„(s)  angular_z(rad/s)
1.118    5.932111
3.256    5.995262
7.170    5.990466
10.839   0.725167  â† ì •ì§€ ì‹œì‘
```

**íŠ¹ì§•**:
- âš ï¸ ê°ì†ë„ **5.9~6.1 rad/s** (ëª…ë ¹: 0.3 rad/s) â†’ **20ë°° ë¹ ë¦„**
- âš ï¸ IMU `sensitivity_gain = 2.0`ìœ¼ë¡œ ì¸í•œ ê³¼ë„í•œ ì¦í­

## ğŸ”¥ í•µì‹¬ ë¬¸ì œ

### ìŠ¤í¬ë¦½íŠ¸ ë¡œì§
```python
# ì›ë˜ ì½”ë“œ - odom_filtered ê¸°ì¤€
current_rotation = self.odom_filtered_yaw - self.initial_odom_filtered_yaw

if abs(current_rotation - target_angle_rad) < math.radians(5.0):
    break  # 85~95ë„ ë²”ìœ„ë©´ ì •ì§€
```

### ì‹¤ì œ ë™ì‘ íë¦„
```
ì´ˆê¸°: odom_filtered_yaw = 0.002231 rad (0.13Â°)
  â†“
[ë¡œë²„ê°€ ì‹¤ì œë¡œ 87Â° íšŒì „]
  â†“
11ì´ˆ í›„: odom_filtered_yaw = 0.004157 rad (0.24Â°)
  â†“
íšŒì „ëŸ‰ ê³„ì‚°: 0.24Â° - 0.13Â° = 0.11Â°
  â†“
ìŠ¤í¬ë¦½íŠ¸ íŒë‹¨: "0.11Â° < 90Â° â†’ ê³„ì† íšŒì „!"
  â†“
[ê³„ì† íšŒì „ ëª…ë ¹ ì „ì†¡]
  â†“
[ë¡œë²„ê°€ 10ë°”í€´ íšŒì „...]
```

## ğŸ” EKFê°€ yawë¥¼ ë¬´ì‹œí•˜ëŠ” ì´ìœ 

### EKF ì„¤ì • í™•ì¸
```yaml
# ekf_config.yaml
odom0: /odom_raw
odom0_config: [true, true, false,    # x, y ìœ„ì¹˜ âœ…
              false, false, true,    # roll, pitch, yaw âœ…
              true, true, false,     # vx, vy, vz âœ…
              false, false, true,    # roll_dot, pitch_dot, yaw_dot âœ…
              false, false, false]   # vx_dot, vy_dot, vz_dot
```

ì„¤ì •ì€ ë§ì§€ë§Œ EKFê°€ ì‹ ë¢°í•˜ì§€ ì•ŠëŠ” ì´ìœ :

### 1. **ê·¹ë„ë¡œ ë†’ì€ ê°ì†ë„**
- íœ  ì˜¤ë„ë©”íŠ¸ë¦¬: 1.35 rad/s (ëª…ë ¹ì˜ 4.5ë°°)
- IMU: 6.0 rad/s (ëª…ë ¹ì˜ 20ë°°)
- EKF: "ì´ ê°’ë“¤ì€ ë¹„ì •ìƒì ì´ì•¼, ë¬´ì‹œ!"

### 2. **Rejection Threshold ì´ˆê³¼**
```yaml
odom0_twist_rejection_threshold: 3.0  # ê°ì†ë„ ì‹ ë¢° í•œê³„
imu0_twist_rejection_threshold: 0.5   # ê°ì†ë„ ì‹ ë¢° í•œê³„
```

- íœ  ê°ì†ë„ 1.35 rad/s < 3.0 â†’ í†µê³¼
- IMU ê°ì†ë„ 6.0 rad/s > 0.5 â†’ **ê±°ë¶€!**
- ê²°ê³¼: EKFê°€ ê°ì†ë„ ì •ë³´ë¥¼ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

### 3. **Yaw ì ë¶„ ë¬¸ì œ**
```
yaw(t) = yaw(t-1) + angular_z * dt
```

- EKFê°€ angular_zë¥¼ ê±°ë¶€í•˜ë©´
- yaw ì—…ë°ì´íŠ¸ë„ ì•ˆë¨
- ê²°ê³¼: yawê°€ 0.13Â°ì—ì„œ ê±°ì˜ ë³€í•˜ì§€ ì•ŠìŒ

## ğŸ› ï¸ í•´ê²° ë°©ë²•

### ê¸´ê¸‰ í•´ê²°: odom_raw ì‚¬ìš© âœ… (ì´ë¯¸ ì ìš©)

```python
# ìˆ˜ì •ëœ ì½”ë“œ
current_rotation = self.odom_raw_yaw - self.initial_odom_raw_yaw  # â† EKF ìš°íšŒ

if abs(current_rotation - target_angle_rad) < math.radians(5.0):
    break
```

**ì¥ì **:
- âœ… ì¦‰ì‹œ ë™ì‘ ê°€ëŠ¥
- âœ… EKF ë¬¸ì œ ìš°íšŒ
- âœ… ì‹¤ì œ íœ  íšŒì „ëŸ‰ ë°˜ì˜

**ë‹¨ì **:
- âš ï¸ ì„¼ì„œ ìœµí•© ì´ì  ìƒì‹¤
- âš ï¸ íœ  ìŠ¬ë¦½ ì‹œ ì˜¤ì°¨ ë°œìƒ

### ê·¼ë³¸ í•´ê²°: IMU/ëª¨í„° ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í•„ìš”

#### 1. IMU sensitivity_gain ì¡°ì •
```python
# transbot_driver.py (line 304-307)
sensitivity_gain = 2.0  # â† ë¬¸ì œ! 20ë°° ì¦í­
msg.angular_velocity.z = float(gz) * sensitivity_gain

# ìˆ˜ì • í•„ìš”:
sensitivity_gain = 1.0  # ë˜ëŠ” ë” ë‚®ì€ ê°’
```

#### 2. ëª¨í„° ì†ë„ ìŠ¤ì¼€ì¼ë§ ì¡°ì •
```python
# transbot_driver.py (line 174-177)
turn_speed = angular_z * (100.0 / 0.5)  # â† ìŠ¤ì¼€ì¼ë§ í™•ì¸

# 0.3 rad/s ëª…ë ¹ â†’ turn_speed = 60
# í•˜ì§€ë§Œ ì‹¤ì œ ê°ì†ë„ 1.35 rad/s â†’ 4.5ë°° ë¹ ë¦„!
# ìˆ˜ì • í•„ìš”:
turn_speed = angular_z * (100.0 / 1.35)  # ì‹¤ì œ ë¹„ìœ¨ ë°˜ì˜
```

#### 3. EKF ì‹ ë¢°ë„ ì¡°ì •
```yaml
# ekf_config.yaml
imu0_twist_rejection_threshold: 10.0  # 0.5 â†’ 10.0 (IMU ê°ì†ë„ í—ˆìš©)
odom0_twist_rejection_threshold: 5.0  # 3.0 â†’ 5.0 (íœ  ê°ì†ë„ í—ˆìš©)

# ë˜ëŠ” process_noise_covariance ì¡°ì •
process_noise_covariance[11]: 0.05  # yaw_dot ë…¸ì´ì¦ˆ ì¦ê°€ (ëœ ë¯¼ê°)
```

## ğŸ“ í…ŒìŠ¤íŠ¸ ìˆœì„œ

### 1ë‹¨ê³„: ê¸´ê¸‰ í…ŒìŠ¤íŠ¸ (í˜„ì¬ ìˆ˜ì • ì ìš©)
```bash
./run_rotation_test.sh
```
- odom_raw ê¸°ì¤€ìœ¼ë¡œ 90ë„ì—ì„œ ì •ì§€í•˜ëŠ”ì§€ í™•ì¸
- ì˜ˆìƒ: ì •ìƒ ë™ì‘

### 2ë‹¨ê³„: IMU sensitivity_gain ì¡°ì •
```bash
# transbot_driver.py ìˆ˜ì •
sensitivity_gain = 1.0  # 2.0 â†’ 1.0

# ì¬ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸
colcon build --packages-select transbot_bringup
ros2 launch sllidar_ros2 transbot_full_system.launch.py
```

### 3ë‹¨ê³„: ëª¨í„° ìº˜ë¦¬ë¸Œë ˆì´ì…˜
```bash
ros2 run transbot_bringup calibrate_angular
```

### 4ë‹¨ê³„: EKF ì¬í…ŒìŠ¤íŠ¸
- IMU/ëª¨í„° ìˆ˜ì • í›„
- odom_filteredê°€ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ odom_filtered ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½

## ğŸ“ˆ ì˜ˆìƒ ê²°ê³¼

### Before (odom_filtered ê¸°ì¤€)
```
ëª…ë ¹: 90Â° íšŒì „
ì‹¤ì œ: 3600Â° íšŒì „ (10ë°”í€´)
ì´ìœ : EKFê°€ yawë¥¼ 0.17Â°ë¡œë§Œ ì¸ì‹
```

### After (odom_raw ê¸°ì¤€)
```
ëª…ë ¹: 90Â° íšŒì „
ì‹¤ì œ: 87Â° íšŒì „
ì •ì§€: 11.5ì´ˆì— ëª©í‘œ ë„ë‹¬ë¡œ ì •ì§€
```

### ìµœì¢… ëª©í‘œ (IMU/ëª¨í„° ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í›„)
```
ëª…ë ¹: 90Â° íšŒì „ (0.3 rad/s)
ì‹¤ì œ: 90Â±5Â° íšŒì „ (0.3 rad/s)
odom_filtered ì •ìƒ ë™ì‘
EKF ìœµí•© ì •ìƒ
```

## ğŸ¯ ê²°ë¡ 

**ë¬¸ì œ**: EKFê°€ ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ì€ ê°ì†ë„(IMU 6 rad/s, íœ  1.35 rad/s)ë¥¼ ì‹ ë¢°í•˜ì§€ ì•Šì•„ yaw ì—…ë°ì´íŠ¸ë¥¼ ê±°ë¶€ â†’ odom_filteredê°€ 0.17Â°ë§Œ ì¸ì‹ â†’ ìŠ¤í¬ë¦½íŠ¸ê°€ ê³„ì† íšŒì „ ëª…ë ¹ ì „ì†¡ â†’ 10ë°”í€´ íšŒì „

**ê¸´ê¸‰ í•´ê²°**: odom_raw ê¸°ì¤€ìœ¼ë¡œ ì œì–´ (ì™„ë£Œ âœ…)

**ê·¼ë³¸ í•´ê²°**: IMU sensitivity_gain ì¡°ì • + ëª¨í„° ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í•„ìš”
