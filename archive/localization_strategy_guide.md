# Transbot 위치 추정 전략 가이드

## 📍 현재 센서 환경 분석

### 사용 가능한 센서
- **LiDAR**: 2D 스캔 데이터 (환경 인식)
- **IMU**: 6축 센서 (가속도, 자이로스코프)
- **휠 오도메트리**: 차동 구동 로봇 이동 추정

### 부재한 센서 
- **GPS**: 절대 위치 정보 없음
- **지자계 센서**: 절대 방향 정보 없음
- **시각적 랜드마크**: 절대 좌표 기준점 없음

## 🎯 위치 추정 방법 비교

### 1. SLAM Toolbox (현재 적용) - **추천**

#### 장점 ✅
- **맵 동시 생성**: 새로운 환경에서 즉시 시작 가능
- **점진적 개선**: 시간이 지날수록 맵과 위치 정확도 증가  
- **루프 클로저**: 기존 방문 지역 재방문 시 누적 오차 보정
- **실시간 적응**: 환경 변화에 동적 대응

#### 단점 ⚠️
- **초기 불확실성**: 시작 시 위치와 방향 불정확
- **계산 부하**: 맵 생성과 위치 추정 동시 수행
- **드리프트 위험**: 장시간 사용 시 누적 오차 발생 가능

#### 적용 시나리오
- ✅ **새로운 환경 탐색**
- ✅ **사전 맵이 없는 상황** 
- ✅ **실시간 맵 생성이 필요한 작업**
- ✅ **환경이 자주 변하는 경우**

### 2. AMCL (기 구현됨) - **조건부 추천**

#### 장점 ✅
- **높은 정확도**: 사전 맵 기반 정밀한 위치 추정
- **계산 효율성**: 위치 추정만 수행 (맵 생성 불필요)
- **안정성**: 기존 맵 기반으로 안정적 성능
- **빠른 수렴**: 초기 위치 설정 후 빠른 정확도 달성

#### 단점 ⚠️
- **사전 맵 필요**: SLAM으로 생성된 맵 필수
- **초기 위치 설정**: 수동으로 대략적 위치 지정 필요
- **환경 변화 취약**: 맵과 실제 환경 차이 시 성능 저하
- **맵 의존성**: 맵 품질이 위치 추정 성능 결정

#### 적용 시나리오
- ✅ **기존에 생성된 맵이 있는 경우**
- ✅ **반복적인 동일 경로 운행**
- ✅ **높은 정확도가 필요한 작업**
- ✅ **계산 자원이 제한적인 환경**

## 🚀 권장 전략

### Phase 1: SLAM 모드 (탐색 및 맵 생성)
```bash
# SLAM으로 새 환경 탐색 및 맵 생성
ros2 launch sllidar_ros2 transbot_full_system.launch.py use_amcl:=false use_rviz:=true

# 맵 저장
ros2 run nav2_map_server map_saver_cli -f /home/user/transbot_ws_ros2/maps/my_map
```

### Phase 2: AMCL 모드 (정밀 운행)
```bash  
# 저장된 맵으로 AMCL 위치 추정
ros2 launch sllidar_ros2 transbot_full_system.launch.py use_amcl:=true map:=/home/user/transbot_ws_ros2/maps/my_map.yaml

# RViz2에서 "2D Pose Estimate"로 초기 위치 설정
```

## 🔧 현재 시스템 최적화 상태

### EKF 설정 최적화 ✅
- **오도메트리 토픽**: `/odom` (실제 발행 토픽명으로 수정)
- **센서 역할 분담**: 오도메트리(위치+yaw각도), IMU(yaw각속도 전담)
- **초기 불확실성**: yaw=1000.0 (절대 방향 불확실성 반영)

### SLAM 파라미터 최적화 ✅
- **회전 감지**: minimum_travel_heading=0.05 (좌우 회전 향상)
- **루프 클로저**: 활성화 (누적 오차 보정)
- **스캔 매칭**: 활성화 (정밀도 향상)

### IMU 필터 최적화 ✅
- **6축 전용**: 지자계 센서 없음 고려
- **상대적 방향**: 절대 방향 측정 불가 반영
- **노이즈 억제**: 드리프트 최소화 설정

## 📊 성능 예상

### SLAM Toolbox
- **초기 정확도**: 낮음 → **최종 정확도**: 높음
- **맵 품질**: 점진적 개선
- **적응성**: 매우 높음

### AMCL (사전 맵 사용)
- **초기 정확도**: 높음 → **최종 정확도**: 매우 높음  
- **맵 품질**: 사전 맵 의존
- **적응성**: 낮음

## 🎯 결론

**현재 환경(절대 좌표 센서 부재)에서는 SLAM Toolbox가 최적**

이유:
1. **자립성**: 외부 기준점 없이도 동작
2. **적응성**: 환경 변화에 유연 대응
3. **완전성**: 맵 생성과 위치 추정 동시 해결
4. **확장성**: 생성된 맵으로 추후 AMCL 전환 가능