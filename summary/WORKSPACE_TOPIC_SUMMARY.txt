# Transbot ROS2 작업공간 패키지 및 토픽/메시지 요약

## 패키지 목록
- transbot_ctrl: 조이스틱 제어, /cmd_vel, /Adjust 발행
- transbot_base: 하드웨어 인터페이스, 센서/모터 제어
- transbot_nav: 네비게이션, 경로계획, 맵
- transbot_laser: 라이다 센서, 장애물 회피
- transbot_bringup: 전체 시스템 런치/통합
- transbot_msgs: 커스텀 메시지 정의

## 주요 토픽 및 메시지

### transbot_ctrl
- /cmd_vel (geometry_msgs/Twist): 로봇 속도 명령
- /Adjust (transbot_msgs/Adjust): 조이스틱 상태
- /joy (sensor_msgs/Joy): 조이스틱 입력 (구독)

### transbot_base
- 하드웨어 센서 및 모터 관련 토픽 (예: /odom, /battery, /joint_states 등)
- 메시지: std_msgs, geometry_msgs, sensor_msgs, transbot_msgs

### transbot_nav
- /map (nav_msgs/OccupancyGrid): 맵 데이터
- /path (nav_msgs/Path): 경로 데이터
- /goal (geometry_msgs/PoseStamped): 목표 위치
- /cmd_vel (geometry_msgs/Twist): 속도 명령 (구독)

### transbot_laser
- /scan (sensor_msgs/LaserScan): 라이다 데이터
- /laser_avoid (transbot_msgs/LaserAvoid): 장애물 회피 정보

### transbot_bringup
- 전체 시스템 런치, 상태 모니터링, TF 등

### transbot_msgs (커스텀 메시지 예시)
- Adjust.msg: bool adjust
- JoyState.msg: bool state
- LaserAvoid.msg: int32 angle_range, float32 response_distance, float32 speed
- Battery.msg: float32 voltage
- Position.msg: float32 angle_x, float32 angle_y, float32 distance

## 동작 구조 요약
- 사용자가 조이스틱을 움직이면 `/joy` 토픽에 메시지가 발행됨
- `transbot_ctrl`가 `/joy`를 구독하여 `/cmd_vel`(속도), `/Adjust`(상태) 토픽을 발행
- `/cmd_vel`은 하드웨어 인터페이스(`transbot_base`)와 네비게이션(`transbot_nav`)에서 구독하여 실제 로봇을 움직임
- 라이다 센서(`transbot_laser`)는 `/scan`을 발행하고, 장애물 회피 정보(`/laser_avoid`)를 제공
- 모든 패키지는 커스텀 메시지(`transbot_msgs`)를 통해 데이터 교환
- `transbot_bringup`은 전체 시스템을 런치하고, TF/상태/센서/모터 등 모든 노드를 통합 관리

## 패키지별 상세 데이터 흐름 및 관련 파일

### transbot_ctrl
- 데이터 흐름:
  - 구독: `/joy` (sensor_msgs/Joy) —> `transbot_joy*.py`에서 입력 처리
  - 발행: `/cmd_vel` (geometry_msgs/Twist) —> 로봇 이동 명령
  - 발행: `/Adjust` (transbot_msgs/Adjust) —> 조이스틱 활성 상태
- 핵심 파일:
  - `src/transbot_ctrl/transbot_ctrl/transbot_joy.py`
  - `src/transbot_ctrl/transbot_ctrl/transbot_joy_simple.py`
  - `src/transbot_ctrl/transbot_ctrl/transbot_joy_new.py`
  - `src/transbot_ctrl/transbot_ctrl/twist_joy.py`
  - `src/transbot_ctrl/transbot_ctrl/transbot_keyboard.py`

### transbot_base
- 데이터 흐름:
  - 구독: `/transbot/get_vel` (geometry_msgs/Twist) —> `base.cpp::velCallback`에서 수신하여 모터 명령으로 변환
  - 발행: `odom_raw` (nav_msgs/Odometry) —> 로봇 위치/속도 정보
  - 내부: TF 브로드캐스트 (`tf2_ros::TransformBroadcaster`) —> `odom`/`base_footprint` 프레임
- 핵심 파일:
  - `src/transbot_base/src/base.cpp`
  - `src/transbot_base/src/base_node.cpp` (노드 초기화 및 실행)

### transbot_nav
- 데이터 흐름:
  - 구독: `clicked_point` (geometry_msgs/PointStamped) —> 사용자가 RViz에서 클릭한 지점 수집
  - 구독: `initialpose` (PoseWithCovarianceStamped) —> 초기 포즈 설정
  - 발행: `path_points` (visualization_msgs/MarkerArray) —> 경로 마커 표시
  - 액션: `navigate_to_pose` (nav2_msgs action) —> 네비게이션 서버로 목표 전송
  - 발행: `rtabmap/initialpose` (PoseWithCovarianceStamped) —> RTAB-Map 초기 포즈 전달
- 핵심 파일:
  - `src/transbot_nav/transbot_nav/multipoint_navigation.py`
  - `src/transbot_nav/transbot_nav/send_mark.py`

### transbot_laser
- 데이터 흐름:
  - 구독: `scan` (sensor_msgs/LaserScan) —> 레이저 스캔 데이터 수신
  - 발행: `cmd_vel` (geometry_msgs/Twist) —> 장애물 회피를 위한 속도 명령(우선순위로 하드웨어 드라이버와 경쟁 가능)
- 핵심 파일:
  - `src/transbot_laser/transbot_laser/laser_avoidance.py`
  - `src/transbot_laser/transbot_laser/laser_tracker.py`
  - `src/transbot_laser/transbot_laser/laser_warning.py`

### transbot_bringup
- 데이터 흐름:
  - 하드웨어 드라이버로서 IMU와 속도 정보를 주기적으로 발행:
    - 발행: `/transbot/imu` (sensor_msgs/Imu)
    - 발행: `/transbot/get_vel` (geometry_msgs/Twist)
  - 구독: `/cmd_vel` (geometry_msgs/Twist) —> `transbot_driver.py::cmd_vel_callback`에서 모터 제어로 변환
  - 서비스: `/CurrentAngle` (transbot_msgs/RobotArm srv) —> 로봇 암 제어/상태 제공
- 핵심 파일:
  - `src/transbot_bringup/transbot_bringup/transbot_driver.py`
  - `src/transbot_bringup/transbot_bringup/arm_transbot.py`
  - `src/transbot_bringup/transbot_bringup/device_srv.py`
  - `src/transbot_bringup/transbot_bringup/base.py`

### transbot_msgs
- 역할: 커스텀 메시지/서비스 정의
- 주요 메시지 파일:
  - `msg/Adjust.msg`
  - `msg/JoyState.msg`
  - `msg/LaserAvoid.msg`
  - `msg/Battery.msg`
  - `msg/Position.msg`

## 노드 간 우선순위/충돌 주의
- `/cmd_vel`은 여러 소스(수동 조이스틱, 네비게이션, 라이다 회피)가 발행할 수 있음. 런타임에서 어떤 노드가 우선 제어할지(예: 토픽 전환, 행동 제어, 우선순위 브리지 등)를 확인 필요.

---
이 파일은 transbot_ws_ros2 작업공간의 주요 패키지, 토픽, 메시지, 동작 흐름을 요약한 것입니다.
